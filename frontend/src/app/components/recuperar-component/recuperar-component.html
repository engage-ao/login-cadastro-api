<div class="relative min-h-screen">
  <!-- FUNDO -->
  <div
    class="fixed inset-0 bg-cover bg-center bg-no-repeat"
    style="background-image: url('assets/images/esqueceu1.png')"
  >
    <div class="absolute inset-0 bg-black opacity-20"></div>
  </div>

  <!-- CONTEÚDO -->
  <div class="relative z-10 flex min-h-screen items-center justify-center px-4 py-8">
    <div class="bg-white w-full max-w-md mx-auto p-8 rounded-xl shadow-2xl">
      <!-- LOGO -->
      <div class="flex justify-center mb-6">
        <img src="assets/images/logo.png" alt="Engage" class="h-10" />
      </div>

      <!-- TÍTULO -->
      <h2 class="text-xl font-semibold text-gray-900 mb-2 text-center">Alterar palavra-passe</h2>

      <p class="text-sm text-gray-600 mb-6 text-center">
        Crie uma nova palavra-passe para acessar sua conta
      </p>

      <!-- TOKEN INVÁLIDO -->
      <div
        *ngIf="tokenInvalido"
        class="mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg text-sm text-center"
      >
        <p class="font-semibold mb-2">Token inválido ou não encontrado</p>

        <button
          (click)="goToLogin()"
          class="mt-2 bg-purple-600 hover:bg-purple-700 text-white py-2 px-4 rounded-lg transition"
        >
          Voltar ao login
        </button>
      </div>

      <!-- ERRO -->
      <div
        *ngIf="errorMessage && !tokenInvalido"
        class="mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded-lg text-sm"
      >
        {{ errorMessage }}
      </div>

      <!-- SUCESSO -->
      <div
        *ngIf="senhaAlterada"
        class="mb-4 p-3 bg-green-100 border border-green-400 text-green-700 rounded-lg text-sm text-center"
      >
        {{ successMessage }}
        <p class="mt-2 text-xs">Redirecionando para o login em 3 segundos...</p>
      </div>

      <!-- FORMULÁRIO (só aparece se token válido e senha não alterada) -->
      <form *ngIf="!tokenInvalido && !senhaAlterada" (ngSubmit)="onSubmit()" class="space-y-4">
        <!-- NOVA SENHA -->
        <div>
          <label class="block text-sm text-gray-700 mb-2"> Nova palavra-passe </label>

          <div class="relative">
            <input
              [type]="mostrarSenha ? 'text' : 'password'"
              [(ngModel)]="data.nova_senha"
              (input)="validarSenhaRequisitos()"
              name="nova_senha"
              placeholder="Digite sua nova palavra-passe"
              [disabled]="isLoading"
              class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 disabled:bg-gray-100 disabled:cursor-not-allowed"
            />

            <span
              (click)="toggleMostrarSenha()"
              class="absolute right-3 top-3 cursor-pointer text-gray-500 text-sm"
            >
              {{ mostrarSenha ? 'Ocultar' : 'Mostrar' }}
            </span>
          </div>

          <!-- REQUISITOS -->
          <ul class="text-xs mt-2 space-y-1">
            <li [class.text-green-600]="senhaRequisitos.minLength">• Mínimo 6 caracteres</li>
            <li [class.text-green-600]="senhaRequisitos.hasUpper">
              • Pelo menos 1 letra maiúscula
            </li>
            <li [class.text-green-600]="senhaRequisitos.hasLower">
              • Pelo menos 1 letra minúscula
            </li>
            <li [class.text-green-600]="senhaRequisitos.hasNumber">• Pelo menos 1 número</li>
          </ul>
        </div>

        <!-- CONFIRMAR SENHA -->
        <div>
          <label class="block text-sm text-gray-700 mb-2"> Confirmar palavra-passe </label>

          <div class="relative">
            <input
              [type]="mostrarConfirmarSenha ? 'text' : 'password'"
              [(ngModel)]="data.confirmar_senha"
              name="confirmar_senha"
              placeholder="Confirme sua nova palavra-passe"
              [disabled]="isLoading"
              class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 disabled:bg-gray-100 disabled:cursor-not-allowed"
            />

            <span
              (click)="toggleMostrarConfirmarSenha()"
              class="absolute right-3 top-3 cursor-pointer text-gray-500 text-sm"
            >
              {{ mostrarConfirmarSenha ? 'Ocultar' : 'Mostrar' }}
            </span>
          </div>
        </div>

        <!-- BOTÃO -->
        <button
          type="submit"
          [disabled]="isLoading"
          class="w-full bg-purple-600 hover:bg-purple-700 text-white py-3 rounded-lg font-medium transition disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center justify-center"
        >
          <span *ngIf="!isLoading">Confirmar nova senha</span>

          <span *ngIf="isLoading" class="flex items-center">
            <svg class="animate-spin h-5 w-5 mr-2" viewBox="0 0 24 24">
              <circle
                class="opacity-25"
                cx="12"
                cy="12"
                r="10"
                stroke="currentColor"
                stroke-width="4"
                fill="none"
              ></circle>
              <path
                class="opacity-75"
                fill="currentColor"
                d="M4 12a8 8 0 018-8V0
                       C5.373 0 0 5.373 0 12h4zm2 5.291
                       A7.962 7.962 0 014 12H0
                       c0 3.042 1.135 5.824 3 7.938l3-2.647z"
              ></path>
            </svg>
            Processando...
          </span>
        </button>

        <!-- VOLTAR -->
        <button
          type="button"
          (click)="goToLogin()"
          [disabled]="isLoading"
          class="w-full border-2 border-purple-600 text-purple-600 py-3 rounded-lg font-medium hover:bg-purple-50 transition disabled:opacity-50 disabled:cursor-not-allowed"
        >
          Voltar ao login
        </button>
      </form>
    </div>
  </div>
</div>
